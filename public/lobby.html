<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
</head>
<body>
    <h1>
        Join Game with <span id="gameId"></span>
    </h1>
    <ul>
        <li>
            <a href="host.html">Host Game</a>
        </li>
    </ul>
    <ul id="players"></ul>
    <div id="qrcode"></div>
    <a id="link">link</a>
    <button onclick="startHost()">
        Start Game
    </button>


<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/master/qrcode.js"></script>
    <script src = "../socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var gameId;
        var game = 'demo';
        socket.emit('startLobby', {
            game: game
        });

        socket.on('hostgameId', function(data){
            console.log(data);
            document.getElementById('gameId').innerText = data.game.gameId;
            gameId = data.game.gameId;
            let qrcode = new QRCode("qrcode");
            let link = `http://${data.ip}:3000/join/${data.game.name}/${data.game.gameId}`;
            let anchor = document.getElementById('link');
            anchor.href = link;
            anchor.innerText = link;
            qrcode.makeCode(link);
        });

        socket.on('updateLobby',function(data){
            console.log('players on game ');
            console.log(data);
            let playerList = document.getElementById('players');
            let str = "";
            data.forEach(element => {
                str += `<li>${element.name}</li>`;
            });
            playerList.innerHTML = str;
        });

        function startHost(){
            console.log('starting host');
            window.location.href='http://' + window.location.host + '/host/' + game;
            localStorage.setItem('gameId',gameId);
            localStorage.setItem('playerId',"HOST");
        }
    </script>

</body>
</html>